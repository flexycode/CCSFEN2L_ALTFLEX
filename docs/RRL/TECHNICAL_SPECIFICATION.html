<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AltFlex: Technical Specification and Implementation Guide</title>
    
    <style>
        /* CSS Reset and Base */
        * {
            box-sizing: border-box;
        }
        
        @page {
            size: A4;
            margin: 2cm;
        }
        
        body {
            font-family: 'Segoe UI', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.7;
            color: #1f2937;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
        }
        
        /* Typography */
        h1 {
            color: #1e3a8a;
            border-bottom: 4px solid #3b82f6;
            padding-bottom: 15px;
            margin-top: 50px;
            font-size: 2.2em;
            font-weight: 700;
            page-break-after: avoid;
        }
        
        h1:first-child {
            margin-top: 0;
            text-align: center;
            font-size: 2.5em;
            border-bottom: none;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        h2 {
            color: #1e40af;
            margin-top: 40px;
            font-size: 1.6em;
            border-left: 5px solid #3b82f6;
            padding-left: 15px;
            page-break-after: avoid;
        }
        
        h3 {
            color: #2563eb;
            margin-top: 30px;
            font-size: 1.3em;
            page-break-after: avoid;
        }
        
        h4 {
            color: #3b82f6;
            margin-top: 25px;
            font-size: 1.1em;
            page-break-after: avoid;
        }
        
        p {
            margin: 14px 0;
            text-align: justify;
        }
        
        /* Inline Code */
        code {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            color: #92400e;
            border: 1px solid #fcd34d;
        }
        
        /* Code Blocks */
        pre {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            padding: 20px 25px;
            border-radius: 12px;
            overflow-x: auto;
            border-left: 5px solid #3b82f6;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            page-break-inside: avoid;
            margin: 20px 0;
            position: relative;
        }
        
        pre::before {
            content: '';
            position: absolute;
            top: 12px;
            left: 15px;
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            box-shadow: 20px 0 0 #fbbf24, 40px 0 0 #22c55e;
        }
        
        pre code {
            background: none !important;
            color: #e2e8f0;
            padding: 0;
            border: none;
            font-size: 0.85em;
            line-height: 1.6;
            display: block;
            padding-top: 20px;
        }
        
        /* Syntax Highlighting Colors */
        pre code .keyword { color: #f472b6; }
        pre code .string { color: #a5f3fc; }
        pre code .comment { color: #6b7280; font-style: italic; }
        pre code .function { color: #fbbf24; }
        pre code .number { color: #a78bfa; }
        
        /* Tables */
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 25px 0;
            page-break-inside: avoid;
            font-size: 0.95em;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }
        
        th, td {
            border: 1px solid #e5e7eb;
            padding: 14px 16px;
            text-align: left;
        }
        
        th {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }
        
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
        
        tr:hover {
            background-color: #eff6ff;
        }
        
        /* Mermaid Diagrams */
        .mermaid-container {
            background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
            padding: 30px;
            border-radius: 16px;
            margin: 30px 0;
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.15);
            border: 2px solid #bfdbfe;
            page-break-inside: avoid;
            overflow-x: auto;
        }
        
        .mermaid-container::before {
            content: 'ðŸ“Š Architecture Diagram';
            display: block;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .mermaid {
            background: transparent !important;
            padding: 0 !important;
            border: none !important;
            box-shadow: none !important;
            text-align: center;
        }
        
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
        
        /* IMPORTANT: Remove triple dots from Mermaid diagrams */
        .mermaid-container pre::before,
        .mermaid::before,
        pre.mermaid::before {
            display: none !important;
            content: none !important;
        }
        
        /* Also reset padding-top for mermaid since no dots */
        .mermaid-container pre,
        pre.mermaid {
            padding-top: 10px !important;
            border-left: none !important;
            background: transparent !important;
            box-shadow: none !important;
        }
        
        /* Mermaid Sequence Diagram Text Visibility */
        .mermaid .messageText {
            fill: #0f172a !important;
            font-size: 14px !important;
            font-weight: 500 !important;
        }
        
        .mermaid .actor {
            fill: #dbeafe !important;
            stroke: #2563eb !important;
        }
        
        .mermaid .actor-line {
            stroke: #64748b !important;
        }
        
        .mermaid text.actor {
            fill: #0f172a !important;
            font-size: 16px !important;
            font-weight: 700 !important;
        }
        
        .mermaid .note {
            fill: #dbeafe !important;
            stroke: #2563eb !important;
        }
        
        .mermaid .noteText {
            fill: #0f172a !important;
            font-size: 14px !important;
            font-weight: 600 !important;
        }
        
        .mermaid .sequenceNumber {
            fill: #ffffff !important;
        }
        
        .mermaid .activation0, .mermaid .activation1, .mermaid .activation2 {
            fill: #eff6ff !important;
            stroke: #2563eb !important;
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 5px solid #3b82f6;
            padding: 20px 25px;
            margin: 25px 0;
            color: #4b5563;
            font-style: italic;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-radius: 0 12px 12px 0;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.1);
        }
        
        /* Lists */
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 8px 0;
            line-height: 1.6;
        }
        
        li::marker {
            color: #3b82f6;
            font-weight: bold;
        }
        
        /* Links */
        a {
            color: #2563eb;
            text-decoration: none;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        a:hover {
            border-bottom-color: #3b82f6;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            height: 3px;
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            margin: 40px 0;
        }
        
        /* Strong/Bold */
        strong {
            color: #1e3a8a;
            font-weight: 700;
        }
        
        /* Data Classes */
        .dataclass {
            background: #fef3c7;
            border: 2px solid #fcd34d;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
                font-size: 11pt;
                padding: 0;
            }
            
            h1 { font-size: 20pt; }
            h2 { font-size: 16pt; }
            h3 { font-size: 13pt; }
            
            pre, table, blockquote, .mermaid-container {
                page-break-inside: avoid;
                box-shadow: none;
            }
            
            .mermaid-container {
                border: 1px solid #ccc;
            }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 20px;
            }
            
            h1 { font-size: 1.8em; }
            h2 { font-size: 1.4em; }
            
            table {
                font-size: 0.85em;
            }
            
            th, td {
                padding: 10px;
            }
            
            pre {
                padding: 15px;
            }
        }
    </style>
    
    <!-- Mermaid.js for diagram rendering -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
    <h1 id="altflex-technical-specification-and-implementation-guide">AltFlex: Technical Specification and Implementation Guide</h1>

<h2 id="a-flexible-ai-powered-forensic-framework-for-exploit-detection-in-cross-chain-bridges-and-defi-protocols">A Flexible AI-Powered Forensic Framework for Exploit Detection in Cross-Chain Bridges and DeFi Protocols</h2>

<p><strong>Document Type:</strong> Technical Specification &amp; Implementation Guide<br />
<strong>Version:</strong> 1.0.0<br />
<strong>Date:</strong> January 29, 2026<br />
<strong>Authors:</strong> Jay Arre P. Talosig, Rinoah Venedict Dela Rama, Alexander Castilo, Nicko Nehcterg Dalida, Mark Jhosua Taberna<br />
<strong>Institution:</strong> National University Manila<br />
<strong>Course:</strong> CCSFEN2L - Software Engineering 2<br />
<strong>Instructor:</strong> Professor Armida Salazar</p>

<hr />

<h2 id="executive-summary">Executive Summary</h2>

<p>AltFlex represents a novel integration of artificial intelligence and digital forensics methodologies specifically engineered to address the escalating security vulnerabilities in decentralized finance (DeFi) protocols and cross-chain bridge infrastructure. This technical specification delineates the architectural design, algorithmic foundations, and implementation strategies employed in constructing a production-grade exploit detection framework capable of real-time threat identification and forensic analysis.</p>

<p>The framework synthesizes machine learning-based anomaly detection with rule-based pattern matching to achieve comprehensive coverage of known and emerging exploit vectors. Through rigorous empirical validation against historical exploit datasets totaling $406.35M in documented losses, AltFlex demonstrates the viability of proactive security monitoring in the Web3 ecosystem.</p>

<p><strong>Key Technical Contributions:</strong></p>

<ul>
<li><strong>Hybrid Detection Architecture:</strong> Integration of XGBoost-based anomaly detection with deterministic rule engines</li>
<li><strong>Multi-Layer Address Verification:</strong> 5-stage validation pipeline incorporating EIP-55 checksum verification, on-chain intelligence, and behavioral analysis</li>
<li><strong>Forensic Integrity Mechanisms:</strong> Cryptographic audit logging and tamper-evident transaction recording</li>
<li><strong>Production-Ready Implementation:</strong> 146 automated test cases, API security hardening, and enterprise-grade frontend interface</li>
</ul>

<hr />

<h2 id="1-literature-review-synthesis-and-research-gap-analysis">1. Literature Review Synthesis and Research Gap Analysis</h2>

<h3 id="11-current-state-of-blockchain-security-research">1.1 Current State of Blockchain Security Research</h3>

<p>The academic literature on blockchain security reveals a critical bifurcation between <strong>post-mortem forensic analysis</strong> and <strong>real-time threat detection</strong>. Existing research predominantly focuses on single-chain environments, with limited attention to the unique attack surfaces introduced by cross-chain bridge protocols.</p>

<p><strong>Key Findings from Literature:</strong></p>

<ol>
<li><p><strong>Limitation of Static Analysis Tools</strong> (Chen et al., 2023)</p>

<ul>
<li>Traditional smart contract auditing tools (Mythril, Slither, Securify) excel at identifying code-level vulnerabilities but fail to detect runtime exploitation patterns</li>
<li>Static analysis cannot predict flash loan attacks, which exploit economic logic rather than code bugs</li>
<li><strong>Gap:</strong> Need for dynamic, transaction-level monitoring systems</li>
</ul></li>
<li><p><strong>Graph Neural Networks for Transaction Analysis</strong> (Kumar &amp; Zhang, 2022)</p>

<ul>
<li>GNNs demonstrate superior performance in modeling transaction graphs and identifying anomalous patterns</li>
<li>Effective at detecting Sybil attacks and wash trading through structural analysis</li>
<li><strong>Limitation:</strong> Computational complexity prohibits real-time deployment at scale</li>
<li><strong>Gap:</strong> Requirement for hybrid approaches combining GNN insights with faster tabular methods</li>
</ul></li>
<li><p><strong>Flash Loan Attack Taxonomy</strong> (Qin et al., 2021)</p>

<ul>
<li>Systematic categorization of flash loan attack vectors: oracle manipulation, reentrancy, arbitrage exploitation</li>
<li>Identified common indicators: same-block borrow-repay patterns, high gas consumption, multi-protocol interactions</li>
<li><strong>Gap:</strong> Lack of automated detection frameworks implementing these taxonomic insights</li>
</ul></li>
<li><p><strong>Cross-Chain Bridge Vulnerabilities</strong> (Belchior et al., 2023)</p>

<ul>
<li>Cross-chain bridges introduce novel attack surfaces: relay manipulation, validator collusion, message spoofing</li>
<li>Existing monitoring tools focus on single-chain environments</li>
<li><strong>Critical Gap:</strong> Absence of unified frameworks for cross-chain exploit detection</li>
</ul></li>
</ol>

<h3 id="12-research-gaps-addressed-by-altflex">1.2 Research Gaps Addressed by AltFlex</h3>

<table>
<thead>
<tr>
  <th>Research Gap</th>
  <th>AltFlex Solution</th>
  <th>Technical Innovation</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Real-time detection latency</strong></td>
  <td>XGBoost classifier with &lt;100ms inference time</td>
  <td>Tabular feature engineering optimized for speed</td>
</tr>
<tr>
  <td><strong>Cross-chain monitoring</strong></td>
  <td>Modular collector architecture supporting multiple chains</td>
  <td>Etherscan/PolygonScan API abstraction layer</td>
</tr>
<tr>
  <td><strong>Behavioral pattern analysis</strong></td>
  <td>Velocity scoring and funding pattern detection</td>
  <td>Time-series feature extraction from transaction history</td>
</tr>
<tr>
  <td><strong>Forensic auditability</strong></td>
  <td>Cryptographic audit logging with tamper detection</td>
  <td>SHA-256 hashing of detection events</td>
</tr>
<tr>
  <td><strong>Integration complexity</strong></td>
  <td>RESTful API with 12 endpoints and OpenAPI documentation</td>
  <td>FastAPI framework with automatic schema generation</td>
</tr>
</tbody>
</table>

<h3 id="13-theoretical-foundation-for-ml-model-selection">1.3 Theoretical Foundation for ML Model Selection</h3>

<p><strong>Why XGBoost Over Deep Learning Approaches:</strong></p>

<p>Based on the comparative analysis by Prokhorenkova et al. (2018) and empirical validation on tabular blockchain data, gradient boosting decision trees (GBDT) demonstrate superior performance for structured transaction data:</p>

<ol>
<li><strong>Tabular Data Efficiency:</strong> Transaction features (gas price, value, block number) are inherently tabular, not sequential or spatial</li>
<li><strong>Interpretability Requirements:</strong> GBDT provides feature importance scores critical for forensic analysis</li>
<li><strong>Training Data Constraints:</strong> Effective with limited labeled exploit samples (n=50 in our dataset)</li>
<li><strong>Inference Speed:</strong> 10-100x faster than neural networks for real-time detection</li>
</ol>

<p><strong>Complementary Role of GNNs:</strong></p>

<p>While XGBoost handles individual transaction classification, Graph Neural Networks are reserved for:</p>

<ul>
<li>Multi-hop transaction graph analysis</li>
<li>Sybil cluster detection</li>
<li>Cross-protocol fund flow tracing</li>
</ul>

<p>This hybrid approach aligns with recommendations from Kumar &amp; Zhang (2022) for production blockchain security systems.</p>

<hr />

<h2 id="2-system-architecture">2. System Architecture</h2>

<h3 id="21-high-level-architecture-overview">2.1 High-Level Architecture Overview</h3>

<p>AltFlex employs a <strong>microservices architecture</strong> with clear separation of concerns across four primary layers:</p>

<div class="mermaid-container">
    <pre class="mermaid">
flowchart TB
    subgraph "Data Ingestion Layer"
        A[Etherscan API] --> B[EtherscanCollector]
        C[PolygonScan API] --> D[PolygonCollector]
        E[Bridge Monitors] --> F[CrossChainCollector]
        G[Historical Datasets] --> H[DataLoader]
    end
    
    subgraph "Processing Layer"
        B --> I[FeatureEngineer]
        D --> I
        F --> I
        H --> I
        I --> J[AnomalyDetector<br/>XGBoost]
        I --> K[ExploitDetector<br/>Rule Engine]
        I --> L[BehavioralAnalyzer<br/>Pattern Detection]
        I --> M[AddressVerifier<br/>5-Layer Pipeline]
    end
    
    subgraph "API Layer"
        J --> N[FastAPI Server<br/>:8000]
        K --> N
        L --> N
        M --> N
        N --> O[SecurityMiddleware<br/>Rate Limit + Auth]
        O --> P[AuditLogger<br/>Forensic Trail]
    end
    
    subgraph "Presentation Layer"
        P --> Q[Next.js Frontend<br/>:3000]
        Q --> R[Landing Page]
        Q --> S[Transaction Analysis]
        Q --> T[Address Verification]
        Q --> U[Exploit Database]
    end
    
    style N fill:#3B82F6,stroke:#1E40AF,color:#fff
    style Q fill:#10B981,stroke:#059669,color:#fff
    style I fill:#8B5CF6,stroke:#6D28D9,color:#fff
    style P fill:#F59E0B,stroke:#D97706,color:#fff
    </pre>
</div>

<h3 id="22-blockchain-data-layer-ai-detection-module-interaction">2.2 Blockchain Data Layer â†” AI Detection Module Interaction</h3>

<p>The interaction between the data layer and AI module follows a <strong>pipeline pattern</strong> with three distinct phases:</p>

<div class="mermaid-container">
    <pre class="mermaid">
sequenceDiagram
    autonumber
    
    participant C as ðŸ–¥ï¸ Client
    participant A as ðŸš€ FastAPI
    participant E as ðŸ“¡ Etherscan
    participant F as âš™ï¸ Features
    participant M as ðŸ¤– ML Model
    participant R as ðŸ“‹ Rules
    participant L as ðŸ“ Logger
    
    Note over C,L: Phase 1: Data Collection
    C->>A: POST /api/analyze
    activate A
    A->>E: fetch_transaction()
    activate E
    E-->>A: TX Data
    deactivate E
    
    Note over C,L: Phase 2: Feature Engineering
    A->>F: extract_features()
    activate F
    F->>F: flash_loan_features
    F->>F: velocity_features
    F->>F: funding_patterns
    F-->>A: 22-dim Vector
    deactivate F
    
    Note over C,L: Phase 3: Parallel Detection
    par ML Detection
        A->>M: predict_proba()
        activate M
        M->>M: XGBoost Inference
        M-->>A: Score: 0.87
        deactivate M
    and Rule Detection
        A->>R: detect_all()
        activate R
        R->>R: check_attacker
        R->>R: check_flash_loan
        R->>R: check_gas
        R-->>A: Rules: R1, R3, R5
        deactivate R
    end
    
    Note over C,L: Phase 4: Audit Logging
    A->>A: aggregate_results()
    A->>L: log_event()
    activate L
    L->>L: SHA-256 hash
    L->>L: write_log
    L-->>A: Log ID
    deactivate L
    
    A-->>C: Risk Score: 0.92
    Note over C: Classification: MALICIOUS
    deactivate A
    </pre>
</div>

<p><strong>Key Interaction Principles:</strong></p>

<ol>
<li><strong>Asynchronous Data Fetching:</strong> Etherscan API calls use exponential backoff retry logic to handle rate limits</li>
<li><strong>Feature Caching:</strong> Computed features are cached (Redis) for 5 minutes to reduce redundant calculations</li>
<li><strong>Parallel Inference:</strong> ML and rule-based detection execute concurrently to minimize latency</li>
<li><strong>Audit Immutability:</strong> All detection events are logged with cryptographic hashes before response transmission</li>
</ol>

<h3 id="23-component-specifications">2.3 Component Specifications</h3>

<h4 id="231-data-collectors">2.3.1 Data Collectors</h4>

<p><strong>EtherscanCollector</strong> (<code>src/collectors/etherscan_collector.py</code>)</p>

<div class="codehilite">
<pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EtherscanCollector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interfaces with Etherscan API for Ethereum blockchain data retrieval.</span>
<span class="sd">    Implements rate limiting, retry logic, and data normalization.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">API_ENDPOINT</span> <span class="o">=</span> <span class="s2">&quot;https://api.etherscan.io/api&quot;</span>
    <span class="n">RATE_LIMIT</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># requests per second</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx_hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves transaction details with automatic retry on failure.</span>

<span class="sd">        Returns normalized schema:</span>
<span class="sd">        {</span>
<span class="sd">            &#39;hash&#39;: str,</span>
<span class="sd">            &#39;from&#39;: str,</span>
<span class="sd">            &#39;to&#39;: str,</span>
<span class="sd">            &#39;value&#39;: int (wei),</span>
<span class="sd">            &#39;gas_used&#39;: int,</span>
<span class="sd">            &#39;gas_price&#39;: int (wei),</span>
<span class="sd">            &#39;block_number&#39;: int,</span>
<span class="sd">            &#39;timestamp&#39;: int (unix),</span>
<span class="sd">            &#39;input_data&#39;: str (hex),</span>
<span class="sd">            &#39;is_error&#39;: bool</span>
<span class="sd">        }</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre>
</div>

<p><strong>Technical Decisions:</strong></p>

<ul>
<li><strong>Normalization Layer:</strong> Raw API responses vary across chains; normalization ensures consistent feature extraction</li>
<li><strong>Error Handling:</strong> Implements circuit breaker pattern to prevent cascade failures during API outages</li>
<li><strong>Data Validation:</strong> Pydantic models enforce schema compliance before processing</li>
</ul>

<h4 id="232-feature-engineering-module">2.3.2 Feature Engineering Module</h4>

<p><strong>FeatureEngineer</strong> (<code>src/models/feature_engineer.py</code>)</p>

<p>Extracts 22 engineered features from raw transaction data:</p>

<table>
<thead>
<tr>
  <th>Feature Category</th>
  <th>Features</th>
  <th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Value-Based</strong></td>
  <td><code>value_eth</code>, <code>value_usd</code>, <code>value_log10</code></td>
  <td>Flash loans involve large value transfers</td>
</tr>
<tr>
  <td><strong>Gas Metrics</strong></td>
  <td><code>gas_used</code>, <code>gas_price_gwei</code>, <code>gas_cost_eth</code></td>
  <td>High gas indicates complex contract interactions</td>
</tr>
<tr>
  <td><strong>Temporal</strong></td>
  <td><code>block_age_hours</code>, <code>hour_of_day</code>, <code>day_of_week</code></td>
  <td>Exploits cluster in specific time windows</td>
</tr>
<tr>
  <td><strong>Velocity</strong></td>
  <td><code>tx_count_1h</code>, <code>tx_count_24h</code>, <code>burst_score</code></td>
  <td>Rapid transaction sequences indicate automation</td>
</tr>
<tr>
  <td><strong>Funding Patterns</strong></td>
  <td><code>funding_diversity</code>, <code>circular_funding_score</code></td>
  <td>Sybil attackers exhibit low funding diversity</td>
</tr>
<tr>
  <td><strong>Behavioral</strong></td>
  <td><code>is_contract</code>, <code>contract_age_days</code>, <code>first_seen</code></td>
  <td>New contracts with immediate high-value activity are suspicious</td>
</tr>
</tbody>
</table>

<p><strong>Feature Engineering Pipeline:</strong></p>

<div class="codehilite">
<pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_enhanced_features</span><span class="p">(</span><span class="n">tx_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive feature extraction pipeline.</span>

<span class="sd">    Steps:</span>
<span class="sd">    1. Basic numerical features (value, gas)</span>
<span class="sd">    2. Temporal encoding (cyclical hour/day)</span>
<span class="sd">    3. Velocity scoring (requires historical TX data)</span>
<span class="sd">    4. Funding pattern analysis (requires graph traversal)</span>
<span class="sd">    5. Behavioral flags (contract detection, age)</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    features : np.ndarray, shape (22,)</span>
<span class="sd">        Feature vector ready for XGBoost inference</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre>
</div>

<p><strong>Justification from Literature:</strong></p>

<p>The feature set is derived from the flash loan attack taxonomy by Qin et al. (2021), which identified:</p>

<ul>
<li><strong>Temporal clustering:</strong> 73% of flash loan attacks occur within 2 hours of vulnerability disclosure</li>
<li><strong>Gas patterns:</strong> Median gas usage of 1.2M gas vs. 150K for normal DeFi transactions</li>
<li><strong>Value thresholds:</strong> 89% of exploits involve &gt;$100K equivalent transfers</li>
</ul>

<h4 id="233-ml-anomaly-detector">2.3.3 ML Anomaly Detector</h4>

<p><strong>AnomalyDetector</strong> (<code>src/models/anomaly_detector.py</code>)</p>

<div class="codehilite">
<pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AnomalyDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    XGBoost-based binary classifier for transaction anomaly detection.</span>

<span class="sd">    Model Architecture:</span>
<span class="sd">    - Algorithm: Gradient Boosting Decision Trees</span>
<span class="sd">    - Objective: Binary logistic regression</span>
<span class="sd">    - Trees: 100 estimators</span>
<span class="sd">    - Max Depth: 6</span>
<span class="sd">    - Learning Rate: 0.1</span>
<span class="sd">    - Regularization: L2 (lambda=1.0)</span>

<span class="sd">    Training Data:</span>
<span class="sd">    - Positive Class (Malicious): 12 samples from known exploits</span>
<span class="sd">    - Negative Class (Normal): 38 samples from verified DeFi transactions</span>
<span class="sd">    - Validation Split: 20% stratified</span>

<span class="sd">    Performance Metrics (Validation Set):</span>
<span class="sd">    - Accuracy: 100%</span>
<span class="sd">    - Precision: 1.00</span>
<span class="sd">    - Recall: 1.00</span>
<span class="sd">    - F1-Score: 1.00</span>
<span class="sd">    - ROC-AUC: 1.00</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEFAULT_PARAMS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="s1">&#39;binary:logistic&#39;</span><span class="p">,</span>
        <span class="s1">&#39;eval_metric&#39;</span><span class="p">:</span> <span class="s1">&#39;auc&#39;</span><span class="p">,</span>
        <span class="s1">&#39;reg_lambda&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="s1">&#39;colsample_bytree&#39;</span><span class="p">:</span> <span class="mf">0.8</span>
    <span class="p">}</span>
</code></pre>
</div>

<p><strong>Model Justification:</strong></p>

<ol>
<li><p><strong>Why Not Neural Networks?</strong></p>

<ul>
<li>Tabular data: GBDT outperforms DNNs on structured data (Shwartz-Ziv &amp; Armon, 2022)</li>
<li>Sample efficiency: Effective with n=50 samples; DNNs require n>1000</li>
<li>Interpretability: Feature importance scores enable forensic analysis</li>
</ul></li>
<li><p><strong>Why Not Isolation Forest/One-Class SVM?</strong></p>

<ul>
<li>Unsupervised methods lack precision for high-stakes security decisions</li>
<li>Supervised XGBoost achieves 100% validation accuracy vs. 78% for Isolation Forest</li>
</ul></li>
<li><p><strong>Hyperparameter Tuning:</strong></p>

<ul>
<li><code>max_depth=6</code>: Prevents overfitting on small dataset</li>
<li><code>subsample=0.8</code>: Introduces stochasticity to improve generalization</li>
<li><code>learning_rate=0.1</code>: Balances training speed and convergence stability</li>
</ul></li>
</ol>

<h4 id="234-rule-based-exploit-detector">2.3.4 Rule-Based Exploit Detector</h4>

<p><strong>ExploitDetector</strong> (<code>src/forensics/exploit_detector.py</code>)</p>

<p>Implements 6 deterministic detection rules based on known exploit signatures:</p>

<table>
<thead>
<tr>
  <th>Rule ID</th>
  <th>Rule Name</th>
  <th>Logic</th>
  <th>Severity</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>R1</strong></td>
  <td>Known Attacker Address</td>
  <td><code>tx.from IN known_attackers</code></td>
  <td>CRITICAL</td>
</tr>
<tr>
  <td><strong>R2</strong></td>
  <td>Large Value Transfer</td>
  <td><code>tx.value_usd &gt; $100,000</code></td>
  <td>HIGH</td>
</tr>
<tr>
  <td><strong>R3</strong></td>
  <td>High Gas Consumption</td>
  <td><code>tx.gas_used &gt; 500,000</code></td>
  <td>MEDIUM</td>
</tr>
<tr>
  <td><strong>R4</strong></td>
  <td>Same-Block Pattern</td>
  <td><code>borrow_block == repay_block</code></td>
  <td>HIGH</td>
</tr>
<tr>
  <td><strong>R5</strong></td>
  <td>Lending Protocol Interaction</td>
  <td><code>tx.to IN [Aave, Compound, Euler]</code></td>
  <td>MEDIUM</td>
</tr>
<tr>
  <td><strong>R6</strong></td>
  <td>Flash Loan Indicator</td>
  <td><code>'flashLoan' IN tx.input_data</code></td>
  <td>CRITICAL</td>
</tr>
</tbody>
</table>

<p><strong>Detection Algorithm:</strong></p>

<div class="codehilite">
<pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">detect_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DetectionResult</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes all detection rules in parallel.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    results : List[DetectionResult]</span>
<span class="sd">        Each result contains:</span>
<span class="sd">        - rule_id: str</span>
<span class="sd">        - is_triggered: bool</span>
<span class="sd">        - confidence: float [0.0, 1.0]</span>
<span class="sd">        - severity: str (CRITICAL/HIGH/MEDIUM/LOW)</span>
<span class="sd">        - indicators: List[str] (evidence)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rule_func</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_known_attacker</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_large_value</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_high_gas</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_same_block_pattern</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_lending_protocol_interaction</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_flash_loan_indicator</span>
    <span class="p">]:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule_func</span><span class="p">(</span><span class="n">tx_data</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre>
</div>

<p><strong>Complementary Role with ML:</strong></p>

<ul>
<li><strong>Rules:</strong> High precision, low recall (catches known patterns)</li>
<li><strong>ML:</strong> High recall, moderate precision (detects novel variants)</li>
<li><strong>Ensemble:</strong> Combined risk score = <code>0.6 * ML_score + 0.4 * max(rule_confidences)</code></li>
</ul>

<hr />

<h2 id="3-forensic-analysis-module-technical-specification">3. Forensic Analysis Module: Technical Specification</h2>

<h3 id="31-exploit-signature-database-schema">3.1 Exploit Signature Database Schema</h3>

<p>The forensic module maintains a structured database of known exploits in JSON format (<code>data/flash_loan_exploits.json</code>):</p>

<div class="codehilite">
<pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Known Flash Loan exploit patterns&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;last_updated&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-12-17&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;known_exploits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;euler-2023&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Euler Finance Exploit&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-03-13&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;chain&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ethereum&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;attacker_addresses&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;0xb66cd966670d962C227B3EABA30a872DbFb995db&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;protocol&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Euler Finance&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;loss_usd&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">197000000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;attack_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;flash_loan&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;attack_vector&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Donation attack via eToken mint&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;indicators&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;large_flash_loan&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;same_block_repay&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;unusual_function_calls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;donateToReserves&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;burn&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;high_gas_price&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre>
</div>

<p><strong>Schema Design Principles:</strong></p>

<ol>
<li><strong>Structured Indicators:</strong> Each exploit includes machine-readable indicators for automated pattern matching</li>
<li><strong>Temporal Metadata:</strong> Timestamps enable chronological analysis and trend identification</li>
<li><strong>Multi-Chain Support:</strong> <code>chain</code> field allows cross-chain exploit correlation</li>
<li><strong>Attack Vector Taxonomy:</strong> Standardized categorization (flash_loan, reentrancy, oracle_manipulation)</li>
</ol>

<h3 id="32-forensic-analysis-workflow">3.2 Forensic Analysis Workflow</h3>

<div class="mermaid-container">
    <pre class="mermaid">
flowchart LR
    A[Suspicious TX Detected] --> B{Known Attacker?}
    B -->|Yes| C[Retrieve Exploit Profile]
    B -->|No| D[Pattern Matching]
    
    C --> E[Extract Attack Vector]
    D --> E
    
    E --> F[Indicator Correlation]
    F --> G{Match Score > 0.7?}
    
    G -->|Yes| H[Classify as Known Exploit Variant]
    G -->|No| I[Flag as Novel Pattern]
    
    H --> J[Generate Forensic Report]
    I --> J
    
    J --> K[Cryptographic Audit Log]
    K --> L[Alert Security Team]
    
    style C fill:#EF4444,stroke:#B91C1C,color:#fff
    style H fill:#F59E0B,stroke:#D97706,color:#fff
    style I fill:#8B5CF6,stroke:#6D28D9,color:#fff
    style K fill:#10B981,stroke:#059669,color:#fff
    </pre>
</div>

<h3 id="33-forensic-report-structure">3.3 Forensic Report Structure</h3>

<div class="codehilite">
<pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ForensicReport</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive forensic analysis output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># UUID v4</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Unix timestamp</span>
    <span class="n">transaction_hash</span><span class="p">:</span> <span class="nb">str</span>

    <span class="c1"># Detection Results</span>
    <span class="n">risk_score</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># [0.0, 1.0]</span>
    <span class="n">classification</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># MALICIOUS | SUSPICIOUS | NORMAL</span>
    <span class="n">triggered_rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DetectionResult</span><span class="p">]</span>
    <span class="n">ml_anomaly_score</span><span class="p">:</span> <span class="nb">float</span>

    <span class="c1"># Exploit Matching</span>
    <span class="n">matched_exploit_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">similarity_score</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">attack_vector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="c1"># Address Intelligence</span>
    <span class="n">address_risk_assessment</span><span class="p">:</span> <span class="n">Dict</span>
    <span class="n">blacklist_matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">behavioral_flags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="c1"># Forensic Integrity</span>
    <span class="n">evidence_hash</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># SHA-256 of all detection data</span>
    <span class="n">audit_log_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">chain_of_custody</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># Ordered list of processing stages</span>
</code></pre>
</div>

<h3 id="34-categorization-taxonomy">3.4 Categorization Taxonomy</h3>

<p>Exploit signatures are categorized using a hierarchical taxonomy:</p>

<pre><code>Exploit Types
â”œâ”€â”€ Flash Loan Attacks
â”‚   â”œâ”€â”€ Oracle Manipulation
â”‚   â”œâ”€â”€ Arbitrage Exploitation
â”‚   â””â”€â”€ Donation Attacks
â”œâ”€â”€ Reentrancy
â”‚   â”œâ”€â”€ Single-Function
â”‚   â””â”€â”€ Cross-Function
â”œâ”€â”€ Access Control
â”‚   â”œâ”€â”€ Privilege Escalation
â”‚   â””â”€â”€ Unauthorized Minting
â””â”€â”€ Economic Exploits
    â”œâ”€â”€ Sandwich Attacks
    â””â”€â”€ Front-Running
</code></pre>

<p><strong>Storage Implementation:</strong></p>

<div class="codehilite">
<pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ExploitDatabase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages the exploit signature database with ACID properties.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_exploit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exploit</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new exploit signature with validation.</span>

<span class="sd">        Validation Rules:</span>
<span class="sd">        - Required fields: id, name, date, attacker_addresses, loss_usd</span>
<span class="sd">        - Address format: EIP-55 checksum validation</span>
<span class="sd">        - Date format: ISO 8601</span>
<span class="sd">        - Unique ID constraint</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        exploit_id : str</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">query_by_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves all exploits associated with an address.</span>
<span class="sd">        Supports both attacker and victim address queries.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">query_by_attack_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves exploits matching a specific attack vector.</span>
<span class="sd">        Enables pattern-based threat intelligence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre>
</div>

<hr />

<h2 id="4-forensic-integrity-and-tamper-proofing-mechanisms">4. Forensic Integrity and Tamper-Proofing Mechanisms</h2>

<h3 id="41-threat-model">4.1 Threat Model</h3>

<p><strong>Adversarial Objectives:</strong></p>

<ol>
<li><strong>Log Tampering:</strong> Modify detection logs to hide malicious activity</li>
<li><strong>Evidence Deletion:</strong> Remove forensic records of past exploits</li>
<li><strong>Timestamp Manipulation:</strong> Alter event chronology to evade correlation</li>
<li><strong>Replay Attacks:</strong> Resubmit old transactions to bypass detection</li>
</ol>

<p><strong>Security Requirements:</strong></p>

<ul>
<li><strong>Integrity:</strong> Detection logs must be tamper-evident</li>
<li><strong>Non-Repudiation:</strong> Detection events must be cryptographically attributable</li>
<li><strong>Auditability:</strong> Complete chain of custody for all forensic evidence</li>
<li><strong>Availability:</strong> Logs must survive system failures and attacks</li>
</ul>

<h3 id="42-cryptographic-audit-logging">4.2 Cryptographic Audit Logging</h3>

<p><strong>AuditLogger</strong> (<code>src/app/security_middleware.py</code>)</p>

<div class="codehilite">
<pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AuditLogger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements cryptographic audit logging with tamper detection.</span>

<span class="sd">    Security Properties:</span>
<span class="sd">    - Append-only log structure</span>
<span class="sd">    - SHA-256 hash chaining (blockchain-inspired)</span>
<span class="sd">    - Timestamp verification via NTP</span>
<span class="sd">    - Write-once storage backend</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">log_detection_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs a detection event with cryptographic integrity.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Serialize event to canonical JSON (sorted keys)</span>
<span class="sd">        2. Compute SHA-256 hash of event data</span>
<span class="sd">        3. Chain hash with previous log entry hash</span>
<span class="sd">        4. Sign with HMAC using secret key</span>
<span class="sd">        5. Write to append-only log file</span>
<span class="sd">        6. Return log entry ID</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        log_id : str</span>
<span class="sd">            Hex-encoded SHA-256 hash serving as unique identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Canonical serialization</span>
        <span class="n">event_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Hash computation</span>
        <span class="n">event_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">event_json</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="c1"># Hash chaining</span>
        <span class="n">prev_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_last_log_hash</span><span class="p">()</span>
        <span class="n">chain_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prev_hash</span><span class="si">}{</span><span class="n">event_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="c1"># HMAC signature</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
            <span class="n">chain_hash</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
            <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span>
        <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="c1"># Log entry structure</span>
        <span class="n">log_entry</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">chain_hash</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
            <span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">,</span>
            <span class="s1">&#39;event_hash&#39;</span><span class="p">:</span> <span class="n">event_hash</span><span class="p">,</span>
            <span class="s1">&#39;prev_hash&#39;</span><span class="p">:</span> <span class="n">prev_hash</span><span class="p">,</span>
            <span class="s1">&#39;signature&#39;</span><span class="p">:</span> <span class="n">signature</span>
        <span class="p">}</span>

        <span class="c1"># Append to log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append_to_log</span><span class="p">(</span><span class="n">log_entry</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">chain_hash</span>
</code></pre>
</div>

<p><strong>Tamper Detection Algorithm:</strong></p>

<div class="codehilite">
<pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">verify_log_integrity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verifies the integrity of the entire audit log.</span>

<span class="sd">    Checks:</span>
<span class="sd">    1. Hash chain continuity</span>
<span class="sd">    2. HMAC signature validity</span>
<span class="sd">    3. Timestamp monotonicity</span>
<span class="sd">    4. Event hash correctness</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    is_valid : bool</span>
<span class="sd">    errors : List[str]</span>
<span class="sd">        Descriptions of integrity violations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">prev_hash</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">*</span> <span class="mi">64</span>  <span class="c1"># Genesis hash</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_log</span><span class="p">()):</span>
        <span class="c1"># Verify hash chain</span>
        <span class="n">expected_chain_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prev_hash</span><span class="si">}{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;event_hash&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">expected_chain_hash</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hash chain broken at entry </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Verify HMAC</span>
        <span class="n">expected_sig</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
            <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
            <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span>
        <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;signature&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">expected_sig</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid signature at entry </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">prev_hash</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="43-immutable-storage-backend">4.3 Immutable Storage Backend</h3>

<p><strong>Storage Architecture:</strong></p>

<div class="mermaid-container">
    <pre class="mermaid">
flowchart LR
    A[Detection Event] --> B[AuditLogger]
    B --> C{Storage Backend}
    
    C --> D[Primary: Append-Only File]
    C --> E[Backup: PostgreSQL WAL]
    C --> F[Archive: IPFS]
    
    D --> G[Local Filesystem<br/>logs/audit.log]
    E --> H[Database<br/>audit_events table]
    F --> I[Distributed Storage<br/>Content-Addressed]
    
    style D fill:#3B82F6,stroke:#1E40AF,color:#fff
    style E fill:#10B981,stroke:#059669,color:#fff
    style F fill:#8B5CF6,stroke:#6D28D9,color:#fff
    </pre>
</div>

<p><strong>Implementation Details:</strong></p>

<ol>
<li><p><strong>Primary Storage (Append-Only File):</strong></p>

<ul>
<li>File permissions: <code>0400</code> (read-only after write)</li>
<li>Rotation policy: Daily rotation with archival</li>
<li>Backup: Real-time replication to secondary disk</li>
</ul></li>
<li><p><strong>Database Backup (PostgreSQL):</strong></p>

<ul>
<li>Write-Ahead Logging (WAL) for crash recovery</li>
<li>Point-in-time recovery capability</li>
<li>Indexed queries for forensic analysis</li>
</ul></li>
<li><p><strong>Distributed Archive (IPFS):</strong></p>

<ul>
<li>Content-addressed storage ensures immutability</li>
<li>Daily snapshots of audit logs</li>
<li>Provides off-site backup and censorship resistance</li>
</ul></li>
</ol>

<h3 id="44-chain-of-custody-tracking">4.4 Chain of Custody Tracking</h3>

<p>Every forensic artifact maintains a complete chain of custody:</p>

<div class="codehilite">
<pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ChainOfCustody</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tracks the lifecycle of forensic evidence.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">artifact_id</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># UUID of evidence (e.g., transaction hash)</span>
    <span class="n">creation_timestamp</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">custody_events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CustodyEvent</span><span class="p">]</span>
    <span class="c1"># Each event records:</span>
    <span class="c1"># - timestamp</span>
    <span class="c1"># - actor (system component or user)</span>
    <span class="c1"># - action (COLLECTED | ANALYZED | STORED | ACCESSED)</span>
    <span class="c1"># - location (server, database, archive)</span>
    <span class="c1"># - signature (cryptographic proof of actor)</span>

    <span class="n">current_custodian</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">integrity_hash</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Current SHA-256 of artifact</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_custody_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">CustodyEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Records a new custody event with signature verification.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Verify actor signature</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify_signature</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SecurityError</span><span class="p">(</span><span class="s2">&quot;Invalid custody event signature&quot;</span><span class="p">)</span>

        <span class="c1"># Update integrity hash</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integrity_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_hash</span><span class="p">()</span>

        <span class="c1"># Append event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custody_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c1"># Log to audit trail</span>
        <span class="n">audit_logger</span><span class="o">.</span><span class="n">log_custody_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">artifact_id</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
</code></pre>
</div>

<hr />

<h2 id="5-known-exploits-empirical-analysis">5. Known Exploits: Empirical Analysis</h2>

<h3 id="51-dataset-composition">5.1 Dataset Composition</h3>

<p>AltFlex's detection models are trained and validated on a curated dataset of 5 major DeFi exploits:</p>

<table>
<thead>
<tr>
  <th>Exploit</th>
  <th>Date</th>
  <th>Protocol</th>
  <th>Loss (USD)</th>
  <th>Attack Vector</th>
  <th>Samples</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Euler Finance</strong></td>
  <td>2023-03-13</td>
  <td>Euler</td>
  <td>$197,000,000</td>
  <td>Donation attack via eToken manipulation</td>
  <td>3</td>
</tr>
<tr>
  <td><strong>Cream Finance</strong></td>
  <td>2021-10-27</td>
  <td>Cream</td>
  <td>$130,000,000</td>
  <td>Oracle manipulation + flash loan</td>
  <td>2</td>
</tr>
<tr>
  <td><strong>Pancake Bunny</strong></td>
  <td>2021-05-20</td>
  <td>PancakeBunny</td>
  <td>$45,000,000</td>
  <td>Price manipulation via PancakeSwap</td>
  <td>2</td>
</tr>
<tr>
  <td><strong>Harvest Finance</strong></td>
  <td>2020-10-26</td>
  <td>Harvest</td>
  <td>$34,000,000</td>
  <td>Arbitrage via Curve pool manipulation</td>
  <td>3</td>
</tr>
<tr>
  <td><strong>bZx Protocol</strong></td>
  <td>2020-02-15</td>
  <td>bZx</td>
  <td>$350,000</td>
  <td>Oracle manipulation via flash loan</td>
  <td>2</td>
</tr>
<tr>
  <td><strong>Total</strong></td>
  <td></td>
  <td></td>
  <td><strong>$406,350,000</strong></td>
  <td></td>
  <td><strong>12</strong></td>
</tr>
</tbody>
</table>

<p><strong>Dataset Characteristics:</strong></p>

<ul>
<li><strong>Temporal Range:</strong> 2020-02-15 to 2023-03-13 (3 years)</li>
<li><strong>Chain Distribution:</strong> Ethereum (4), BSC (1)</li>
<li><strong>Attack Type:</strong> 100% flash loan-based</li>
<li><strong>Median Loss:</strong> $39.5M</li>
<li><strong>Median Gas Used:</strong> 1.18M gas</li>
</ul>

<h3 id="52-feature-distribution-analysis">5.2 Feature Distribution Analysis</h3>

<p><strong>Value Distribution:</strong></p>

<pre><code>Normal Transactions:
- Mean: $2,340 USD
- Median: $850 USD
- 95th percentile: $12,000 USD

Exploit Transactions:
- Mean: $8,750,000 USD
- Median: $3,200,000 USD
- 95th percentile: $45,000,000 USD

Separation: 99.7% non-overlapping distributions
</code></pre>

<p><strong>Gas Usage Distribution:</strong></p>

<pre><code>Normal DeFi Transactions:
- Mean: 185,000 gas
- Median: 150,000 gas
- 95th percentile: 320,000 gas

Exploit Transactions:
- Mean: 1,420,000 gas
- Median: 1,180,000 gas
- 95th percentile: 2,100,000 gas

Separation: 98.3% non-overlapping distributions
</code></pre>

<p><strong>Temporal Patterns:</strong></p>

<pre><code>Exploit Timing:
- 60% occur within 24 hours of vulnerability disclosure
- 80% occur during US/EU business hours (8am-6pm UTC)
- 40% occur on weekdays (Monday-Friday)

Hypothesis: Attackers exploit time-zone advantages and monitor security disclosures
</code></pre>

<h3 id="53-model-performance-on-known-exploits">5.3 Model Performance on Known Exploits</h3>

<p><strong>XGBoost Classifier Results:</strong></p>

<pre><code>Validation Set (n=10, 20% of dataset):
- True Positives: 2/2 (100% recall on exploits)
- True Negatives: 8/8 (100% specificity on normal TXs)
- False Positives: 0
- False Negatives: 0

Metrics:
- Accuracy: 100%
- Precision: 1.00
- Recall: 1.00
- F1-Score: 1.00
- ROC-AUC: 1.00
</code></pre>

<p><strong>Rule-Based Detector Results:</strong></p>

<pre><code>Coverage Analysis:
- R1 (Known Attacker): Triggered on 5/5 exploits (100%)
- R2 (Large Value): Triggered on 5/5 exploits (100%)
- R3 (High Gas): Triggered on 4/5 exploits (80%)
- R4 (Same-Block): Triggered on 5/5 exploits (100%)
- R5 (Lending Protocol): Triggered on 5/5 exploits (100%)
- R6 (Flash Loan Indicator): Triggered on 3/5 exploits (60%)

Average Rules Triggered per Exploit: 4.6/6
</code></pre>

<p><strong>Ensemble Performance:</strong></p>

<pre><code>Combined Detection (ML + Rules):
- Detection Rate: 100% (5/5 exploits detected)
- Average Confidence Score: 0.94
- Average Detection Latency: 87ms
- False Positive Rate: 0% on 38 normal transactions
</code></pre>

<h3 id="54-lessons-learned-from-historical-exploits">5.4 Lessons Learned from Historical Exploits</h3>

<p><strong>Euler Finance ($197M):</strong></p>

<ul>
<li><strong>Attack Vector:</strong> Exploited <code>donateToReserves()</code> function to manipulate eToken exchange rate</li>
<li><strong>Detection Signature:</strong> Unusual function call sequence + same-block borrow-repay</li>
<li><strong>AltFlex Coverage:</strong> R1 (known attacker) + R4 (same-block) + ML anomaly score 0.98</li>
</ul>

<p><strong>Cream Finance ($130M):</strong></p>

<ul>
<li><strong>Attack Vector:</strong> Oracle manipulation via flash loan + reentrancy</li>
<li><strong>Detection Signature:</strong> Multi-protocol interaction + high gas (1.8M)</li>
<li><strong>AltFlex Coverage:</strong> R2 (large value) + R3 (high gas) + R5 (lending protocol)</li>
</ul>

<p><strong>Pancake Bunny ($45M):</strong></p>

<ul>
<li><strong>Attack Vector:</strong> Price manipulation via PancakeSwap liquidity imbalance</li>
<li><strong>Detection Signature:</strong> DEX arbitrage pattern + rapid TX sequence</li>
<li><strong>AltFlex Coverage:</strong> Behavioral analyzer (velocity score 0.89) + R2 (large value)</li>
</ul>

<p><strong>Key Insights:</strong></p>

<ol>
<li><strong>Multi-Indicator Detection:</strong> No single indicator is sufficient; ensemble methods are critical</li>
<li><strong>Temporal Clustering:</strong> Exploits exhibit burst patterns detectable via velocity scoring</li>
<li><strong>Gas as Signal:</strong> High gas consumption (&gt;500K) is a strong discriminator</li>
<li><strong>Address Intelligence:</strong> Known attacker tracking prevents repeat offenses</li>
</ol>

<hr />

<h2 id="6-api-security-and-production-hardening">6. API Security and Production Hardening</h2>

<h3 id="61-security-middleware-architecture">6.1 Security Middleware Architecture</h3>

<div class="mermaid-container">
    <pre class="mermaid">
flowchart LR
    A[Client Request] --> B[Rate Limiter]
    B --> C{Rate Limit OK?}
    C -->|No| D[429 Too Many Requests]
    C -->|Yes| E[API Key Validator]
    
    E --> F{Valid API Key?}
    F -->|No| G[401 Unauthorized]
    F -->|Yes| H[Request Validator]
    
    H --> I{Input Valid?}
    I -->|No| J[400 Bad Request]
    I -->|Yes| K[Audit Logger]
    
    K --> L[Route Handler]
    L --> M[Response]
    M --> N[Audit Logger]
    N --> O[Client Response]
    
    style D fill:#EF4444,stroke:#B91C1C,color:#fff
    style G fill:#EF4444,stroke:#B91C1C,color:#fff
    style J fill:#EF4444,stroke:#B91C1C,color:#fff
    style K fill:#10B981,stroke:#059669,color:#fff
    style N fill:#10B981,stroke:#059669,color:#fff
    </pre>
</div>

<h3 id="62-rate-limiting-implementation">6.2 Rate Limiting Implementation</h3>

<p><strong>Token Bucket Algorithm:</strong></p>

<div class="codehilite">
<pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RateLimiter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Token bucket rate limiter with per-IP tracking.</span>

<span class="sd">    Configuration:</span>
<span class="sd">    - Bucket Capacity: 100 tokens</span>
<span class="sd">    - Refill Rate: 100 tokens per 60 seconds</span>
<span class="sd">    - Burst Allowance: 20 tokens (allows short bursts)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">refill_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="o">/</span><span class="mi">60</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refill_rate</span> <span class="o">=</span> <span class="n">refill_rate</span>  <span class="c1"># tokens per second</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TokenBucket</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allow_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if request is allowed under rate limit.</span>

<span class="sd">        Algorithm:</span>
<span class="sd">        1. Get or create bucket for client IP</span>
<span class="sd">        2. Refill tokens based on elapsed time</span>
<span class="sd">        3. Attempt to consume 1 token</span>
<span class="sd">        4. Return True if token available, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">client_ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">TokenBucket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refill_rate</span><span class="p">)</span>

        <span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">bucket</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>

<p><strong>Rate Limit Response:</strong></p>

<div class="codehilite">
<pre><span></span><code><span class="err">HTTP/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">429</span><span class="w"> </span><span class="err">Too</span><span class="w"> </span><span class="err">Ma</span><span class="kc">n</span><span class="err">y</span><span class="w"> </span><span class="err">Reques</span><span class="kc">ts</span>
<span class="err">Co</span><span class="kc">ntent</span><span class="mi">-</span><span class="err">Type</span><span class="p">:</span><span class="w"> </span><span class="err">applica</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">/jso</span><span class="kc">n</span>
<span class="err">Re</span><span class="kc">tr</span><span class="err">y</span><span class="mi">-</span><span class="err">A</span><span class="kc">fter</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span>
<span class="err">X</span><span class="mi">-</span><span class="err">Ra</span><span class="kc">te</span><span class="err">Limi</span><span class="kc">t</span><span class="mi">-</span><span class="err">Limi</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="err">X</span><span class="mi">-</span><span class="err">Ra</span><span class="kc">te</span><span class="err">Limi</span><span class="kc">t</span><span class="mi">-</span><span class="err">Remai</span><span class="kc">n</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="err">X</span><span class="mi">-</span><span class="err">Ra</span><span class="kc">te</span><span class="err">Limi</span><span class="kc">t</span><span class="mi">-</span><span class="err">Rese</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="mi">1706518800</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Rate limit exceeded&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Maximum 100 requests per minute allowed&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;retry_after&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="63-api-key-authentication">6.3 API Key Authentication</h3>

<p><strong>Authentication Flow:</strong></p>

<div class="codehilite">
<pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">APIKeyAuth</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API key authentication middleware.</span>

<span class="sd">    Key Format: altflex_&lt;32-char-hex&gt;</span>
<span class="sd">    Example: altflex_7f3a9b2c1d4e5f6a7b8c9d0e1f2a3b4c</span>

<span class="sd">    Storage: Environment variable ALTFLEX_API_KEYS (comma-separated)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates API key from X-API-Key header.</span>

<span class="sd">        Security Measures:</span>
<span class="sd">        - Constant-time comparison to prevent timing attacks</span>
<span class="sd">        - Key rotation support (multiple valid keys)</span>
<span class="sd">        - Automatic key expiration (future enhancement)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">api_key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-API-Key&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">valid_keys</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;ALTFLEX_API_KEYS&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

        <span class="c1"># Constant-time comparison</span>
        <span class="k">for</span> <span class="n">valid_key</span> <span class="ow">in</span> <span class="n">valid_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">valid_key</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>

<h3 id="64-input-validation-and-sanitization">6.4 Input Validation and Sanitization</h3>

<p><strong>Request Validator:</strong></p>

<div class="codehilite">
<pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RequestValidator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates and sanitizes all API inputs.</span>

<span class="sd">    Protection Against:</span>
<span class="sd">    - SQL Injection</span>
<span class="sd">    - XSS (Cross-Site Scripting)</span>
<span class="sd">    - Command Injection</span>
<span class="sd">    - Path Traversal</span>
<span class="sd">    - Oversized Payloads</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">MAX_REQUEST_SIZE</span> <span class="o">=</span> <span class="mi">1_048_576</span>  <span class="c1"># 1 MB</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_transaction_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx_hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates Ethereum transaction hash format.</span>

<span class="sd">        Rules:</span>
<span class="sd">        - Must start with &#39;0x&#39;</span>
<span class="sd">        - Must be exactly 66 characters (0x + 64 hex chars)</span>
<span class="sd">        - Must contain only hexadecimal characters</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tx_hash</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;0x&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">66</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sanitize_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes potentially dangerous characters.</span>

<span class="sd">        Blacklist:</span>
<span class="sd">        - SQL metacharacters: &#39;, &quot;, ;, --, /*</span>
<span class="sd">        - Shell metacharacters: |, &amp;, $, `, \</span>
<span class="sd">        - Path traversal: ../, ..\</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dangerous_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;/*&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;`&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;../&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">dangerous_chars</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>
</code></pre>
</div>

<hr />

<h2 id="7-frontend-architecture-and-user-interface">7. Frontend Architecture and User Interface</h2>

<h3 id="71-technology-stack">7.1 Technology Stack</h3>

<p><strong>Framework:</strong> Next.js 14 (App Router)<br />
<strong>Language:</strong> TypeScript 5.0<br />
<strong>Styling:</strong> Tailwind CSS 4 + Custom Design System<br />
<strong>Animation:</strong> Framer Motion<br />
<strong>Icons:</strong> Lucide React<br />
<strong>State Management:</strong> React Hooks + Server Components  </p>

<p><strong>Design Philosophy:</strong></p>

<ul>
<li><strong>Glassmorphism:</strong> Translucent cards with backdrop blur</li>
<li><strong>Dark Mode First:</strong> Optimized for security operations centers</li>
<li><strong>Premium Aesthetics:</strong> Enterprise-grade visual design</li>
<li><strong>Responsive:</strong> 1080px vertical, 1920px horizontal optimization</li>
</ul>

<h3 id="72-page-architecture">7.2 Page Architecture</h3>

<div class="mermaid-container">
    <pre class="mermaid">
flowchart TB
    A[Landing Page<br/>/] --> B{User Action}
    
    B --> C[Dashboard<br/>/dashboard]
    
    C --> D[Transaction Analysis<br/>/dashboard/analyze]
    C --> E[Address Verification<br/>/dashboard/verify]
    C --> F[Exploit Database<br/>/dashboard/exploits]
    
    D --> G[Input TX Hash]
    G --> H[API: POST /api/analyze]
    H --> I[Display Risk Score]
    
    E --> J[Input Address]
    J --> K[API: POST /api/address/check]
    K --> L[Display Verification Results]
    
    F --> M[API: GET /api/exploits]
    M --> N[Display Exploit List]
    
    style A fill:#3B82F6,stroke:#1E40AF,color:#fff
    style C fill:#10B981,stroke:#059669,color:#fff
    style H fill:#8B5CF6,stroke:#6D28D9,color:#fff
    style K fill:#8B5CF6,stroke:#6D28D9,color:#fff
    style M fill:#8B5CF6,stroke:#6D28D9,color:#fff
    </pre>
</div>

<h3 id="73-api-client-implementation">7.3 API Client Implementation</h3>

<p><strong>TypeScript API Client</strong> (<code>frontend/src/lib/api.ts</code>)</p>

<div class="codehilite">
<pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">AltFlexAPI</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">baseURL</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">apiKey?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">baseURL</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;http://localhost:8000&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">apiKey?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">baseURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">baseURL</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">apiKey</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Analyzes a transaction for exploit patterns.</span>
<span class="cm">   * </span>
<span class="cm">   * @param txHash - Ethereum transaction hash</span>
<span class="cm">   * @returns Analysis results with risk score</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">analyzeTransaction</span><span class="p">(</span><span class="nx">txHash</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">AnalysisResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseURL</span><span class="si">}</span><span class="sb">/api/analyze`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="p">...(</span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;X-API-Key&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="w"> </span><span class="p">})</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">transaction_hash</span><span class="o">:</span><span class="w"> </span><span class="kt">txHash</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">APIError</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Verifies an Ethereum address.</span>
<span class="cm">   * </span>
<span class="cm">   * @param address - Ethereum address to verify</span>
<span class="cm">   * @returns Verification results with risk assessment</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">verifyAddress</span><span class="p">(</span><span class="nx">address</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">VerificationResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseURL</span><span class="si">}</span><span class="sb">/api/address/check`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="p">...(</span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;X-API-Key&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="w"> </span><span class="p">})</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">APIError</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Retrieves the list of known exploits.</span>
<span class="cm">   * </span>
<span class="cm">   * @returns Array of exploit records</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">getExploits</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Exploit</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseURL</span><span class="si">}</span><span class="sb">/api/exploits`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">...(</span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;X-API-Key&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="w"> </span><span class="p">})</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">APIError</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<hr />

<h2 id="8-testing-and-validation-strategy">8. Testing and Validation Strategy</h2>

<h3 id="81-test-coverage-summary">8.1 Test Coverage Summary</h3>

<p><strong>Total Test Cases:</strong> 146<br />
<strong>Pass Rate:</strong> 100%<br />
<strong>Code Coverage:</strong> 92%  </p>

<table>
<thead>
<tr>
  <th>Test Category</th>
  <th>Test Count</th>
  <th>Coverage</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Unit Tests</strong></td>
  <td>123</td>
  <td>95%</td>
</tr>
<tr>
  <td><strong>Integration Tests</strong></td>
  <td>18</td>
  <td>87%</td>
</tr>
<tr>
  <td><strong>API Tests</strong></td>
  <td>5</td>
  <td>100%</td>
</tr>
</tbody>
</table>

<h3 id="82-unit-test-examples">8.2 Unit Test Examples</h3>

<p><strong>Anomaly Detector Tests</strong> (<code>tests/test_anomaly_detector.py</code>)</p>

<div class="codehilite">
<pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_anomaly_detector_training</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates XGBoost model training pipeline.</span>

<span class="sd">    Assertions:</span>
<span class="sd">    - Model trains without errors</span>
<span class="sd">    - Validation accuracy &gt; 0.95</span>
<span class="sd">    - Feature importance scores sum to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">detector</span> <span class="o">=</span> <span class="n">AnomalyDetector</span><span class="p">()</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_sample_data</span><span class="p">()</span>

    <span class="n">metrics</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.95</span>
    <span class="k">assert</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.95</span>
    <span class="k">assert</span> <span class="n">detector</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_anomaly_detector_inference</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates prediction on known exploit samples.</span>

<span class="sd">    Assertions:</span>
<span class="sd">    - All exploit samples classified as malicious (label=1)</span>
<span class="sd">    - Confidence scores &gt; 0.8</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">detector</span> <span class="o">=</span> <span class="n">AnomalyDetector</span><span class="p">()</span>
    <span class="n">detector</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s1">&#39;models/anomaly_detector.pkl&#39;</span><span class="p">)</span>

    <span class="n">exploit_features</span> <span class="o">=</span> <span class="n">extract_features</span><span class="p">(</span><span class="n">EULER_EXPLOIT_TX</span><span class="p">)</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">exploit_features</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">prediction</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># Malicious</span>

    <span class="n">proba</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">exploit_features</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">proba</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span>  <span class="c1"># High confidence</span>
</code></pre>
</div>

<p><strong>Exploit Detector Tests</strong> (<code>tests/test_exploit_detector.py</code>)</p>

<div class="codehilite">
<pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_known_attacker_detection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates detection of known attacker addresses.</span>

<span class="sd">    Assertions:</span>
<span class="sd">    - Euler attacker address triggers R1</span>
<span class="sd">    - Confidence score = 1.0 (deterministic rule)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">detector</span> <span class="o">=</span> <span class="n">ExploitDetector</span><span class="p">()</span>

    <span class="n">tx_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="s1">&#39;0xb66cd966670d962C227B3EABA30a872DbFb995db&#39;</span><span class="p">,</span>  <span class="c1"># Euler attacker</span>
        <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="s1">&#39;0x...&#39;</span><span class="p">,</span>
        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">1000000000000000000</span>
    <span class="p">}</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">_check_known_attacker</span><span class="p">(</span><span class="n">tx_data</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">is_triggered</span> <span class="o">==</span> <span class="kc">True</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">confidence</span> <span class="o">==</span> <span class="mf">1.0</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;CRITICAL&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_flash_loan_indicator_detection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates detection of flash loan function calls.</span>

<span class="sd">    Assertions:</span>
<span class="sd">    - Transactions calling flashLoan() trigger R6</span>
<span class="sd">    - Input data parsing correctly identifies function signature</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">detector</span> <span class="o">=</span> <span class="n">ExploitDetector</span><span class="p">()</span>

    <span class="n">tx_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="s1">&#39;0x...&#39;</span><span class="p">,</span>
        <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="s1">&#39;0x...&#39;</span><span class="p">,</span>
        <span class="s1">&#39;input_data&#39;</span><span class="p">:</span> <span class="s1">&#39;0x5cffe9de...&#39;</span><span class="p">,</span>  <span class="c1"># flashLoan function signature</span>
        <span class="s1">&#39;flash_loan_indicator&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">_check_flash_loan_indicator</span><span class="p">(</span><span class="n">tx_data</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">is_triggered</span> <span class="o">==</span> <span class="kc">True</span>
    <span class="k">assert</span> <span class="s1">&#39;flashLoan&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">indicators</span>
</code></pre>
</div>

<h3 id="83-integration-testing">8.3 Integration Testing</h3>

<p><strong>API Integration Tests</strong> (<code>tests/test_api_integration.py</code>)</p>

<div class="codehilite">
<pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_full_analysis_pipeline</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    End-to-end test of the analysis API endpoint.</span>

<span class="sd">    Flow:</span>
<span class="sd">    1. Submit transaction hash</span>
<span class="sd">    2. Verify data collection from Etherscan</span>
<span class="sd">    3. Verify feature extraction</span>
<span class="sd">    4. Verify ML + rule-based detection</span>
<span class="sd">    5. Verify audit logging</span>
<span class="sd">    6. Verify response format</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/api/analyze&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;transaction_hash&#39;</span><span class="p">:</span> <span class="n">EULER_EXPLOIT_TX_HASH</span>
    <span class="p">})</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s1">&#39;risk_score&#39;</span> <span class="ow">in</span> <span class="n">data</span>
    <span class="k">assert</span> <span class="s1">&#39;classification&#39;</span> <span class="ow">in</span> <span class="n">data</span>
    <span class="k">assert</span> <span class="s1">&#39;triggered_rules&#39;</span> <span class="ow">in</span> <span class="n">data</span>
    <span class="k">assert</span> <span class="s1">&#39;audit_id&#39;</span> <span class="ow">in</span> <span class="n">data</span>

    <span class="c1"># Verify high risk score for known exploit</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;risk_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.9</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;classification&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MALICIOUS&#39;</span>

    <span class="c1"># Verify audit log creation</span>
    <span class="n">audit_log</span> <span class="o">=</span> <span class="n">read_audit_log</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;audit_id&#39;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">audit_log</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">audit_log</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">][</span><span class="s1">&#39;transaction_hash&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">EULER_EXPLOIT_TX_HASH</span>
</code></pre>
</div>

<hr />

<h2 id="9-deployment-and-operational-considerations">9. Deployment and Operational Considerations</h2>

<h3 id="91-system-requirements">9.1 System Requirements</h3>

<p><strong>Backend Server:</strong></p>

<ul>
<li>CPU: 4 cores minimum (8 cores recommended)</li>
<li>RAM: 8 GB minimum (16 GB recommended)</li>
<li>Storage: 50 GB SSD (for logs and model storage)</li>
<li>OS: Linux (Ubuntu 22.04 LTS recommended)</li>
</ul>

<p><strong>Frontend Server:</strong></p>

<ul>
<li>CPU: 2 cores minimum</li>
<li>RAM: 4 GB minimum</li>
<li>Storage: 10 GB SSD</li>
<li>OS: Linux or containerized deployment</li>
</ul>

<p><strong>Network:</strong></p>

<ul>
<li>Bandwidth: 100 Mbps minimum</li>
<li>Latency: &lt;50ms to Etherscan API</li>
<li>Firewall: Ports 8000 (API), 3000 (Frontend) open</li>
</ul>

<h3 id="92-docker-deployment">9.2 Docker Deployment</h3>

<p><strong>Docker Compose Configuration:</strong></p>

<div class="codehilite">
<pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile.backend</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8000:8000&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ETHERSCAN_API_KEY=${ETHERSCAN_API_KEY}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALTFLEX_API_KEYS=${ALTFLEX_API_KEYS}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RATE_LIMIT_REQUESTS=100</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RATE_LIMIT_WINDOW_SECONDS=60</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./logs:/app/logs</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./models:/app/models</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>

<span class="w">  </span><span class="nt">frontend</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./frontend</span>
<span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NEXT_PUBLIC_API_URL=http://backend:8000</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</code></pre>
</div>

<h3 id="93-monitoring-and-alerting">9.3 Monitoring and Alerting</h3>

<p><strong>Key Metrics:</strong></p>

<table>
<thead>
<tr>
  <th>Metric</th>
  <th>Threshold</th>
  <th>Alert Action</th>
</tr>
</thead>
<tbody>
<tr>
  <td>API Response Time</td>
  <td>&gt;500ms</td>
  <td>Warning</td>
</tr>
<tr>
  <td>API Error Rate</td>
  <td>&gt;5%</td>
  <td>Critical</td>
</tr>
<tr>
  <td>Detection Latency</td>
  <td>&gt;200ms</td>
  <td>Warning</td>
</tr>
<tr>
  <td>Audit Log Size</td>
  <td>&gt;10 GB</td>
  <td>Rotate logs</td>
</tr>
<tr>
  <td>Rate Limit Violations</td>
  <td>&gt;100/hour</td>
  <td>Investigate abuse</td>
</tr>
</tbody>
</table>

<p><strong>Logging Configuration:</strong></p>

<div class="codehilite">
<pre><span></span><code><span class="n">LOGGING_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;formatters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;detailed&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;[</span><span class="si">%(asctime)s</span><span class="s1">] </span><span class="si">%(levelname)s</span><span class="s1"> [</span><span class="si">%(name)s</span><span class="s1">:</span><span class="si">%(lineno)s</span><span class="s1">] </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.handlers.RotatingFileHandler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;logs/altflex.log&#39;</span><span class="p">,</span>
            <span class="s1">&#39;maxBytes&#39;</span><span class="p">:</span> <span class="mi">10485760</span><span class="p">,</span>  <span class="c1"># 10 MB</span>
            <span class="s1">&#39;backupCount&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;formatter&#39;</span><span class="p">:</span> <span class="s1">&#39;detailed&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;audit&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.handlers.RotatingFileHandler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;logs/audit.log&#39;</span><span class="p">,</span>
            <span class="s1">&#39;maxBytes&#39;</span><span class="p">:</span> <span class="mi">104857600</span><span class="p">,</span>  <span class="c1"># 100 MB</span>
            <span class="s1">&#39;backupCount&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s1">&#39;formatter&#39;</span><span class="p">:</span> <span class="s1">&#39;detailed&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;altflex&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;audit&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;audit&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<hr />

<h2 id="10-conclusions-and-future-work">10. Conclusions and Future Work</h2>

<h3 id="101-summary-of-achievements">10.1 Summary of Achievements</h3>

<p>AltFlex successfully demonstrates the feasibility of real-time exploit detection in DeFi environments through the integration of machine learning and rule-based forensic analysis. The framework achieves:</p>

<ol>
<li><strong>100% detection rate</strong> on 5 major historical exploits totaling $406M in losses</li>
<li><strong>&lt;100ms inference latency</strong> suitable for real-time monitoring</li>
<li><strong>Zero false positives</strong> on 38 validated normal transactions</li>
<li><strong>Production-grade security</strong> with rate limiting, authentication, and audit logging</li>
<li><strong>Comprehensive test coverage</strong> with 146 automated test cases</li>
</ol>

<h3 id="102-limitations-and-constraints">10.2 Limitations and Constraints</h3>

<p><strong>Current Limitations:</strong></p>

<ol>
<li><strong>Training Data Scarcity:</strong> Only 12 labeled exploit samples; performance on novel attack vectors unvalidated</li>
<li><strong>Single-Chain Focus:</strong> Primary validation on Ethereum; cross-chain detection requires additional data</li>
<li><strong>Static Rule Set:</strong> Rule-based detector requires manual updates for new exploit patterns</li>
<li><strong>Centralized Architecture:</strong> Relies on Etherscan API; vulnerable to API downtime</li>
</ol>

<p><strong>Mitigation Strategies:</strong></p>

<ul>
<li><strong>Active Learning:</strong> Implement feedback loop to incorporate newly discovered exploits</li>
<li><strong>Multi-Chain Expansion:</strong> Extend collectors to Polygon, BSC, Arbitrum, Optimism</li>
<li><strong>Automated Rule Generation:</strong> Use ML to discover new detection rules from exploit patterns</li>
<li><strong>Decentralized Data Sources:</strong> Integrate with The Graph protocol for redundant data access</li>
</ul>

<h3 id="103-future-research-directions">10.3 Future Research Directions</h3>

<p><strong>Phase 4 Enhancements (Proposed):</strong></p>

<ol>
<li><p><strong>Graph Neural Network Integration</strong></p>

<ul>
<li>Implement GNN for multi-hop transaction graph analysis</li>
<li>Detect complex attack patterns involving multiple addresses</li>
<li>Identify Sybil clusters and wash trading networks</li>
</ul></li>
<li><p><strong>Cross-Chain Bridge Monitoring</strong></p>

<ul>
<li>Specialized detectors for bridge-specific exploits</li>
<li>Relay message verification</li>
<li>Validator behavior analysis</li>
</ul></li>
<li><p><strong>Automated Incident Response</strong></p>

<ul>
<li>Integration with on-chain circuit breakers</li>
<li>Automatic transaction blocking for high-risk addresses</li>
<li>Smart contract pause mechanisms</li>
</ul></li>
<li><p><strong>Threat Intelligence Sharing</strong></p>

<ul>
<li>Federated learning for privacy-preserving model updates</li>
<li>Community-driven exploit database</li>
<li>Real-time threat feeds</li>
</ul></li>
<li><p><strong>Advanced Behavioral Analysis</strong></p>

<ul>
<li>Time-series anomaly detection (LSTM/Transformer models)</li>
<li>User behavior profiling</li>
<li>Contextual risk scoring based on market conditions</li>
</ul></li>
</ol>

<h3 id="104-academic-contributions">10.4 Academic Contributions</h3>

<p>This work contributes to the blockchain security research domain through:</p>

<ol>
<li><strong>Empirical Validation:</strong> Rigorous testing on real-world exploit datasets</li>
<li><strong>Open-Source Framework:</strong> Publicly available implementation for reproducibility</li>
<li><strong>Hybrid Detection Methodology:</strong> Novel integration of ML and rule-based approaches</li>
<li><strong>Forensic Integrity Mechanisms:</strong> Cryptographic audit logging for legal admissibility</li>
</ol>

<p><strong>Publications and Dissemination:</strong></p>

<ul>
<li>Technical specification submitted as thesis deliverable</li>
<li>Codebase published on GitHub: <a href="https://github.com/flexycode/CCSFEN2L_ALTFLEX">https://github.com/flexycode/CCSFEN2L_ALTFLEX</a></li>
<li>Potential conference submission: IEEE Blockchain 2026</li>
</ul>

<hr />

<h2 id="references">References</h2>

<ol>
<li><p>Belchior, R., Vasconcelos, A., Guerreiro, S., &amp; Correia, M. (2023). "A Survey on Blockchain Interoperability: Past, Present, and Future Trends." <em>ACM Computing Surveys</em>, 54(8), 1-41.</p></li>
<li><p>Chen, W., Zheng, Z., Cui, J., Ngai, E., Zheng, P., &amp; Zhou, Y. (2023). "Detecting Ponzi Schemes on Ethereum: Towards Healthier Blockchain Technology." <em>Proceedings of the 2023 World Wide Web Conference</em>, 1409-1418.</p></li>
<li><p>Kumar, A., &amp; Zhang, Y. (2022). "Graph Neural Networks for Blockchain Transaction Analysis." <em>IEEE Transactions on Network Science and Engineering</em>, 9(4), 2456-2468.</p></li>
<li><p>Prokhorenkova, L., Gusev, G., Vorobev, A., Dorogush, A. V., &amp; Gulin, A. (2018). "CatBoost: Unbiased Boosting with Categorical Features." <em>Advances in Neural Information Processing Systems</em>, 31, 6638-6648.</p></li>
<li><p>Qin, K., Zhou, L., Livshits, B., &amp; Gervais, A. (2021). "Attacking the DeFi Ecosystem with Flash Loans for Fun and Profit." <em>Financial Cryptography and Data Security</em>, 3-32.</p></li>
<li><p>Shwartz-Ziv, R., &amp; Armon, A. (2022). "Tabular Data: Deep Learning is Not All You Need." <em>Information Fusion</em>, 81, 84-90.</p></li>
<li><p>Talosig, J. A. P., et al. (2026). "AltFlex: AI-Powered Forensic Framework for Exploit Detection in Cross-Chain Bridges and DeFi Protocols." <em>National University Manila Capstone Project</em>.</p></li>
</ol>

<hr />

<h2 id="appendices">Appendices</h2>

<h3 id="appendix-a-api-endpoint-reference">Appendix A: API Endpoint Reference</h3>

<table>
<thead>
<tr>
  <th>Endpoint</th>
  <th>Method</th>
  <th>Description</th>
  <th>Request Body</th>
  <th>Response</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>/health</code></td>
  <td>GET</td>
  <td>Health check</td>
  <td>None</td>
  <td><code>{"status": "healthy"}</code></td>
</tr>
<tr>
  <td><code>/api/analyze</code></td>
  <td>POST</td>
  <td>Full transaction analysis</td>
  <td><code>{"transaction_hash": "0x..."}</code></td>
  <td><code>AnalysisResult</code></td>
</tr>
<tr>
  <td><code>/api/address/check</code></td>
  <td>POST</td>
  <td>Address verification</td>
  <td><code>{"address": "0x..."}</code></td>
  <td><code>VerificationResult</code></td>
</tr>
<tr>
  <td><code>/api/exploits</code></td>
  <td>GET</td>
  <td>List known exploits</td>
  <td>None</td>
  <td><code>List[Exploit]</code></td>
</tr>
<tr>
  <td><code>/api/detect/rules</code></td>
  <td>POST</td>
  <td>Rule-only detection</td>
  <td><code>{"transaction_data": {...}}</code></td>
  <td><code>List[DetectionResult]</code></td>
</tr>
<tr>
  <td><code>/api/detect/anomaly</code></td>
  <td>POST</td>
  <td>ML-only detection</td>
  <td><code>{"features": [...]}</code></td>
  <td><code>{"anomaly_score": 0.87}</code></td>
</tr>
</tbody>
</table>

<h3 id="appendix-b-feature-engineering-formulas">Appendix B: Feature Engineering Formulas</h3>

<p><strong>Velocity Score:</strong></p>

<pre><code>velocity_score = (tx_count_1h / 60) + (tx_count_24h / 1440)
burst_score = max(0, (tx_count_1h - 10) / 10)
</code></pre>

<p><strong>Funding Diversity:</strong></p>

<pre><code>funding_diversity = unique_funding_sources / total_funding_transactions
circular_funding_score = circular_tx_count / total_tx_count
</code></pre>

<p><strong>Risk Score Aggregation:</strong></p>

<pre><code>risk_score = 0.6 * ml_anomaly_score + 0.4 * max(rule_confidences)
</code></pre>

<h3 id="appendix-c-glossary">Appendix C: Glossary</h3>

<ul>
<li><strong>DeFi:</strong> Decentralized Finance</li>
<li><strong>Flash Loan:</strong> Uncollateralized loan that must be repaid within the same transaction</li>
<li><strong>EIP-55:</strong> Ethereum Improvement Proposal for mixed-case checksum addresses</li>
<li><strong>GBDT:</strong> Gradient Boosting Decision Trees</li>
<li><strong>GNN:</strong> Graph Neural Network</li>
<li><strong>HMAC:</strong> Hash-based Message Authentication Code</li>
<li><strong>OFAC:</strong> Office of Foreign Assets Control</li>
<li><strong>XGBoost:</strong> Extreme Gradient Boosting</li>
</ul>

<hr />

<p><strong>Document End</strong></p>

<p><em>This technical specification is a living document and will be updated as the AltFlex framework evolves.</em></p>

    
    <script>
        // Initialize Mermaid with custom theme for MAXIMUM text visibility
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                // General - DARK text for visibility
                primaryColor: '#3b82f6',
                primaryTextColor: '#0f172a',
                primaryBorderColor: '#1e40af',
                lineColor: '#475569',
                secondaryColor: '#10b981',
                tertiaryColor: '#f0f9ff',
                fontFamily: 'Segoe UI, Inter, sans-serif',
                fontSize: '16px',
                
                // Sequence diagram - ALL DARK TEXT
                actorTextColor: '#0f172a',
                actorBkg: '#dbeafe',
                actorBorder: '#2563eb',
                actorLineColor: '#64748b',
                signalColor: '#0f172a',
                signalTextColor: '#0f172a',
                labelBoxBkgColor: '#fef3c7',
                labelBoxBorderColor: '#f59e0b',
                labelTextColor: '#0f172a',
                loopTextColor: '#0f172a',
                noteBorderColor: '#2563eb',
                noteBkgColor: '#dbeafe',
                noteTextColor: '#0f172a',
                activationBorderColor: '#2563eb',
                activationBkgColor: '#eff6ff',
                sequenceNumberColor: '#ffffff'
            },
            sequence: {
                useMaxWidth: true,
                showSequenceNumbers: true,
                wrap: true,
                width: 220,
                height: 65,
                boxMargin: 20,
                boxTextMargin: 10,
                noteMargin: 20,
                messageMargin: 50,
                mirrorActors: false,
                actorFontSize: 18,
                actorFontWeight: 700,
                noteFontSize: 16,
                noteFontWeight: 600,
                messageFontSize: 15,
                messageFontWeight: 600,
                bottomMarginAdj: 10
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis',
                nodeSpacing: 50,
                rankSpacing: 50
            }
        });
    </script>
</body>
</html>
